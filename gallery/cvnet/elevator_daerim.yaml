meta:
  name: "대림 엘리베이터 호출 설정 테스트"
  name_en: "Daerim Elevator Call Test"
  description: "CVNet 대림 엘리베이터 호출 버튼과 층수 센서 설정입니다."
  description_en: "CVNet Daerim elevator call button and floor sensor."
  version: "1.0.0"
  author: "wooooooooooook"
  tags: ["elevator", "button", "sensor", "cvnet", "daerim"]

scripts:
  - id: 'elevator_call_sequence'
    actions:
      - action: send_packet
        # Full packet including Header(F7), Checksum(EC), Footer(AA)
        data: [0xF7, 0x20, 0x01, 0xE1, 0x81, 0x02, 0x00, 0x01, 0x00, 0x00, 0x02, 0x31, 0x33, 0xEC, 0xAA]
        checksum: false
      - action: delay
        milliseconds: 100
      - action: send_packet
        # Full packet including Header(F7), Checksum(F2), Footer(AA)
        data: [0xF7, 0x20, 0x01, 0xE1, 0x81, 0x02, 0x00, 0x01, 0x00, 0x00, 0x04, 0x30, 0x38, 0xF2, 0xAA]
        checksum: false

entities:
  sensor:
    - id: 'elevator_floor'
      name: 'Elevator Floor'
      icon: 'mdi:elevator'
      state:
        # ex) f7 20 01 e1 81 02 00 01 00 00 08 30 39 f7 aa
        # HEADER(F7) 20 01 E1 81 02 00 01 호출여부? 00 방향? data[10] data[11] CHECKSUM FOOTER(AA)
        # data 10-11을 ascii로 변환
        data: [0x20, 0x01, 0xE1, 0x81, 0x02, 0x00, 0x01, 0x01, 0x00, 0x00, 0x08]
        mask: [0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00]
      state_number:
        offset: 10
        length: 2
        decode: ascii

  button:
    - id: 'elevator_call_button'
      name: 'Elevator Call'
      icon: 'mdi:elevator-up'
      command_press:
        script: elevator_call_sequence
      discovery_linked_id: 'elevator_floor'
