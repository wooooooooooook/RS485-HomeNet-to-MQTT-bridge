meta:
  name: "환기팬 설정"
  name_en: "Ventilation Fan"
  description: "코맥스 환기팬 설정입니다. 3단 속도와 Auto/Night 모드를 지원합니다."
  description_en: "Commax ventilation fan with 3-speed control and Auto/Night preset modes."
  version: "1.0.0"
  author: "wooooooooooook"
  tags: ["fan", "ventilation", "commax"]

entities:
  #상태      Head,   ON,   ID,  SPD, 0x00, 0x00, 0x00, add checksum
  #상태 OFF  0xF6, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, add checksum
  #상태 LOW  0xF6, 0x04, 0x01, 0x01, 0x00, 0x00, 0x00, add checksum
  #상태 MID  0xF6, 0x04, 0x01, 0x02, 0x00, 0x00, 0x00, add checksum
  #상태 HIGH 0xF6, 0x04, 0x01, 0x03, 0x00, 0x00, 0x00, add checksum
  #상태 AUTO 0xF6, 0x02, 0x01, 0x01, 0x00, 0x00, 0x00, add checksum
  #상태 NIGH 0xF6, 0x06, 0x01, 0x01, 0x00, 0x00, 0x00, add checksum

  #응답 OFF  0xF8, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, add checksum
  #응답 LOW  0xF8, 0x04, 0x01, 0x01, 0x00, 0x00, 0x00, add checksum
  #응답 MID  0xF8, 0x04, 0x01, 0x02, 0x00, 0x00, 0x00, add checksum
  #응답 HIGH 0xF8, 0x04, 0x01, 0x03, 0x00, 0x00, 0x00, add checksum

  #명령      Head,   ID,  CMD,  SPD, 0x00, 0x00, 0x00, add checksum
  #명령 OFF  0x78, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, add checksum
  #명령 ON   0x78, 0x01, 0x01, 0x04, 0x00, 0x00, 0x00, add checksum
  #명령 LOW  0x78, 0x01, 0x02, 0x01, 0x00, 0x00, 0x00, add checksum
  #명령 MID  0x78, 0x01, 0x02, 0x02, 0x00, 0x00, 0x00, add checksum
  #명령 HIGH 0x78, 0x01, 0x02, 0x03, 0x00, 0x00, 0x00, add checksum
  fan:
    - id: 'fan_1'
      name: 'Fan 1'
      state:
        data: [0xF0, 0x00, 0x01]
        mask: [0xF1, 0x00, 0xFF]
      state_on:
        offset: 1
        data: [0x00]
        inverted: True
      state_off:
        offset: 1
        data: [0x00]
      command_on:
        data: [0x78, 0x01, 0x01, 0x04, 0x00, 0x00, 0x00]
        ack: [0xF8, 0x04]
      command_off:
        data: [0x78, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00]
        ack: [0xF8, 0x00]
      command_speed: >-
        [[0x78, 0x01, 0x02, x, 0x00, 0x00, 0x00], [0xF8, 0x04]]
      state_speed:
        offset: 3
        signed: False
      preset_modes:
        - 'Auto'
        - 'Night'
      state_preset: >-
        data[1] == 0x02 ? "Auto" : (data[1] == 0x06 ? "Night" : "")
